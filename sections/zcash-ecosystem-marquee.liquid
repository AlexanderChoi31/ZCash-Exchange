{{ 'zcash-theme.css' | asset_url | stylesheet_tag }}

<section class="zcash-section color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width">
    <div class="zcash-section-header">
      <div>
        {%- if section.settings.eyebrow != blank -%}
          <p class="zcash-section-header__eyebrow">{{ section.settings.eyebrow }}</p>
        {%- endif -%}
        <h2 class="zcash-section-header__title">{{ section.settings.heading }}</h2>
      </div>
      {%- if section.settings.description != blank -%}
        <p>{{ section.settings.description }}</p>
      {%- endif -%}
    </div>

    <div id="Marquee-{{ section.id }}" class="zcash-marquee" aria-live="polite">
      <div class="zcash-marquee__rail" data-rail>
        {%- if section.blocks.size > 0 -%}
          {%- for block in section.blocks -%}
            <article class="zcash-card zcash-marquee__item" {{ block.shopify_attributes }}>
              <header class="zcash-section-header" style="margin-bottom: 1rem;">
                <div class="zcash-hero__badge">
                  {%- assign logo_text = block.settings.logo_text | default: 'ZEC' -%}
                  {%- assign logo_text_downcase = logo_text | downcase -%}
                  <span class="zcash-logo-mark" aria-hidden="true">
                    {%- if logo_text_downcase == 'zec' -%}
                      {% render 'zcash-logo' %}
                    {%- else -%}
                      {{ logo_text }}
                    {%- endif -%}
                  </span>
                  <div>
                    <p class="zcash-section-header__eyebrow">{{ block.settings.meta }}</p>
                    <span>{{ block.settings.title }}</span>
                  </div>
                </div>
              </header>
              <p><strong>{{ block.settings.subtitle }}</strong></p>
              <p>{{ block.settings.body }}</p>
              {%- if block.settings.link_label != blank -%}
                <a class="button button--secondary button--inverted" href="{{ block.settings.link | default: '#' }}" target="_blank" rel="noopener">
                  {{ block.settings.link_label }}
                </a>
              {%- endif -%}
            </article>
          {%- endfor -%}
        {%- else -%}
          <article class="zcash-card zcash-marquee__item">
            <div class="zcash-hero__badge">
              <span class="zcash-logo-mark" aria-hidden="true">{% render 'zcash-logo' %}</span>
              <div>
                <p class="zcash-section-header__eyebrow">Zashi</p>
                <span>Official wallet</span>
              </div>
            </div>
            <p><strong>Shielded wallet experience</strong></p>
            <p>Showcase how Zashi is bringing mobile-first shielded ZEC to more people.</p>
            <a class="button button--secondary" href="https://electriccoin.co/zashi/" target="_blank" rel="noopener">See Zashi</a>
          </article>
          <article class="zcash-card zcash-marquee__item">
            <div class="zcash-hero__badge">
              <span class="zcash-logo-mark" aria-hidden="true">@X</span>
              <div>
                <p class="zcash-section-header__eyebrow">Zooko</p>
                <span>Founder insights</span>
              </div>
            </div>
            <p><strong>Follow Zooko on X</strong></p>
            <p>Stay updated on protocol direction and community highlights.</p>
            <a class="button button--secondary" href="https://twitter.com/zooko" target="_blank" rel="noopener">Open X</a>
          </article>
          <article class="zcash-card zcash-marquee__item">
            <div class="zcash-hero__badge">
              <span class="zcash-logo-mark" aria-hidden="true">ECC</span>
              <div>
                <p class="zcash-section-header__eyebrow">Electric Coin Co</p>
                <span>Research & blogs</span>
              </div>
            </div>
            <p><strong>Latest on shielded UX</strong></p>
            <p>Link to ECC posts on privacy, compliance, and product direction.</p>
            <a class="button button--secondary" href="https://electriccoin.co/blog/" target="_blank" rel="noopener">Visit blog</a>
          </article>
        {%- endif -%}
      </div>
      <p class="zcash-marquee__status">{{ section.settings.status_label }}</p>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var marquee = document.getElementById('Marquee-{{ section.id }}');
    if (!marquee) return;
    var rail = marquee.querySelector('[data-rail]');
    if (!rail) return;
    var items = Array.from(rail.querySelectorAll('.zcash-marquee__item'));
    if (items.length <= 1) return;

    var originalCount = items.length;
    var firstClone = items[0].cloneNode(true);
    firstClone.setAttribute('aria-hidden', 'true');
    rail.appendChild(firstClone);

    var index = 0;
    var interval = {{ section.settings.interval | times: 1000 | default: 4000 }};
    var needsReset = false;

    function getStep() {
      var first = rail.querySelector('.zcash-marquee__item');
      if (!first) return 0;
      var width = first.getBoundingClientRect().width;
      var styles = window.getComputedStyle(rail);
      var gap = parseFloat(styles.columnGap || styles.gap || 0);
      return width + gap;
    }

    function setTransform(targetIndex, animate) {
      var distance = getStep() * targetIndex;
      rail.style.transition = animate ? 'transform 0.85s cubic-bezier(0.4, 0, 0.2, 1)' : 'none';
      rail.style.transform = 'translateX(' + -distance + 'px)';
    }

    function tick() {
      index += 1;
      setTransform(index, true);
      if (index === originalCount) {
        needsReset = true;
      }
    }

    rail.addEventListener('transitionend', function(event) {
      if (!needsReset || event.propertyName !== 'transform') return;
      setTransform(0, false);
      index = 0;
      needsReset = false;
    });

    setTransform(0, false);
    var timer = setInterval(tick, interval);

    window.addEventListener('resize', function() {
      setTransform(index, false);
    });
  });
</script>

{% schema %}
{
  "name": "Zcash ecosystem marquee",
  "settings": [
    { "type": "text", "id": "eyebrow", "label": "Eyebrow", "default": "Ecosystem" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "People + products to spotlight" },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Auto-advancing stories pull in Zashi, Zooko, ECC and more so your narrative keeps moving."
    },
    {
      "type": "text",
      "id": "status_label",
      "label": "Ticker status label",
      "default": "Auto scrolling every 4s"
    },
    {
      "type": "range",
      "id": "interval",
      "label": "Scroll interval (seconds)",
      "min": 3,
      "max": 8,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1",
      "options": [
        { "value": "background-1", "label": "Background 1" },
        { "value": "background-2", "label": "Background 2" },
        { "value": "inverse", "label": "Inverse" },
        { "value": "accent-1", "label": "Accent 1" },
        { "value": "accent-2", "label": "Accent 2" }
      ]
    }
  ],
  "blocks": [
    {
      "type": "story",
      "name": "Story",
      "settings": [
        { "type": "text", "id": "logo_text", "label": "Logo text", "default": "ZEC" },
        { "type": "text", "id": "meta", "label": "Meta label", "default": "Zashi" },
        { "type": "text", "id": "title", "label": "Title", "default": "Zashi mobile wallet" },
        { "type": "text", "id": "subtitle", "label": "Subtitle", "default": "Shielded-first UX" },
        {
          "type": "textarea",
          "id": "body",
          "label": "Body",
          "default": "Highlight how Zashi walks through shielded payments, viewing keys, and fiat ramps."
        },
        { "type": "text", "id": "link_label", "label": "Link label", "default": "Open link" },
        { "type": "url", "id": "link", "label": "Link" }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Zcash marquee",
      "blocks": [
        { "type": "story" },
        { "type": "story" },
        { "type": "story" },
        { "type": "story" }
      ]
    }
  ]
}
{% endschema %}
